<div bb-page>

  <div bb-event>

    <div class="event-header" bb-background-image="event.image.url">
      <div class="event-details">
        <h1 class="truncate-sm">{{event.chain.name}}</h1>
        <ul class="row event-summary-list">
          <li class="col-xs-6 col-sm-4 date truncate-xs">
            <span class="fa fa-calendar-o"></span>
            <span class="hidden-xs">{{event.date | datetime:'dddd '}}</span><span>{{event.date | datetime:'Do MMMM YYYY'}}</span>
          </li>
          <li class="col-xs-6 col-sm-4 time truncate-xs">
            <span class="fa fa-clock-o" aria-hidden="true"></span>
            <span class="event-time" ng-bind="event.date | datetime:'LT'"></span>&ndash;<span ng-bind="event.end_datetime | datetime: 'LT'"></span>
          </li>
          <li class="hidden-xs col-sm-4 duration truncate-xs">
            <span class="fa fa-hourglass-half"></span>
            <span ng-bind="event.duration | time_period"></span>
          </li>
          <li class="col-xs-12 location" ng-show="event.chain.address">
            <span class="fa fa-map-marker"></span>
            <span ng-bind="event.chain.address | address_single_line"></span>
          </li>
        </ul>
      </div>
    </div>

    <div class="panel panel-default event-description" ng-show="event.chain.description">
      <div class="panel-body">
        <p ng-bind-html="event.chain.description"></p>
      </div>
    </div>

    <div class="panel panel-default" ng-show="event.chain.long_description">
      <div class="panel-body">
        <div>
          <h2 class="heading"><span translate="PUBLIC_BOOKING.EVENT.EVENT_DETAILS_TITLE"></span></h2>
          <p ng-bind-html="event.chain.long_description"></p>
        </div>

        <div bb-custom-booking-text class="bb-custom-booking-text text-block">
          <p ng-repeat="msg in messages" ng-bind-html="msg"></p>
        </div>
      </div>
    </div>

    <div class="panel panel-default event-tickets">
      <div class="panel-body">
        <h2 ng-show="bb.basket.hasWaitlistItem()" class="heading" ng-bind="!selected_tickets ? 'Waitlist' : 'Waitlist summary'"></h2>
        <h2 ng-show="!bb.basket.hasWaitlistItem()" class="heading" ng-bind="!selected_tickets ? 'Tickets' : 'Ticket summary'"></h2>
        <div ng-form name="ticket_form" role="form">

          <ul class="ticket-list">
            <li class="header">
              <div class="row">
                <div class="col-sm-6 col-xs-6"><span translate="PUBLIC_BOOKING.EVENT.ITEM_TYPE"></span></div>
                <div class="col-sm-3 col-xs-4"><span translate="PUBLIC_BOOKING.EVENT.ITEM_PRICE"></span></div>
                <div class="col-sm-3 col-xs-2"><span translate="PUBLIC_BOOKING.EVENT.ITEM_QTY"></span></div>
              </div>
            </li>
            <li ng-repeat="ticket in event.tickets">
              <div class="row">
                <div class="col-sm-6 col-xs-6">
                  <span>{{ticket.fullName()}}</span>
                </div>
                <div class="col-sm-3 col-xs-4">
                  <span ng-show="ticket.price > 0">{{ticket.price | currency}}</span><span ng-show="ticket.price == 0" translate="PUBLIC_BOOKING.EVENT.ITEM_FREE"></span>
                  <small ng-show="ticket.counts_as"><i>(for {{ticket.counts_as}})</i></small>
                </div>
                <div ng-show="event.getSpacesLeft() > 0 || event.getWaitSpacesLeft() > 0" class="col-sm-3 col-xs-2">
                  <span ng-show="selected_tickets">{{ticket.qty}}</span>
                  <select ng-if="!selected_tickets" ng-model="ticket.qty" ng-options="n as n for n in ticket.getRange(event)">
                    <option value="">-</option>
                  </select>
                </div>
                <div ng-show="event.getSpacesLeft() == 0 && event.getWaitSpacesLeft() == 0" class="col-sm-3 col-xs-2">
                  <span translate="PUBLIC_BOOKING.EVENT.EVENT_SOLD_OUT"></span>
                </div>
              </div>
            </li>
            <li ng-show="selected_tickets && bb.basket.questionPrice()">
              <div class="row">
                <div class="col-sm-6 col-xs-6 text-right"><span translate="PUBLIC_BOOKING.EVENT.ADD_ONS"></span></div>
                <div class="col-sm-3 col-xs-6">{{bb.basket.questionPrice() | currency}}</div>
              </div>
            </li>
            <li ng-show="selected_tickets && (bb.basket.hasCoupon() || bb.basket.hasDeal())">
              <div class="row">
                <div class="col-sm-6 col-xs-6 total-label"><span translate="PUBLIC_BOOKING.EVENT.SUBTOTAL"></span></div>
                <div class="col-sm-3 col-xs-6">{{bb.basket.fullPrice() | currency}}</div>
              </div>
            </li>

            <li ng-show="selected_tickets && bb.basket.hasDeal()">
              <div class="row">
                <div class="col-sm-6 col-xs-6 text-right">
                  <div><span translate="PUBLIC_BOOKING.EVENT.BASKET_GIFT_CERTIFICATE"></span></div>
                </div>
                <div class="col-sm-3 col-xs-6">
                  <div>{{bb.basket.totalDealPaid() | currency}}</div>
                </div>
              </div>
            </li>
            <li ng-show="selected_tickets && bb.basket.hasCoupon()">
              <div class="row">
                <div class="col-sm-6 col-xs-6 text-right"><span translate="PUBLIC_BOOKING.EVENT.BASKET_DISCOUNT"></span></div>
                <div class="col-sm-3 col-xs-6">-{{bb.basket.totalCoupons() | currency }} <!-- <span>(10%)</span></div> -->
                </div>
              </div>
            </li>
            <li ng-show="selected_tickets">
              <div class="row">
                <div class="col-sm-6 col-xs-6 total-label"><span translate="PUBLIC_BOOKING.EVENT.BASKET_TOTAL"></span></div>
                <div class="col-sm-3 col-xs-6"><strong>{{bb.basket.totalPrice() | currency}}</strong></div>
              </div>
            </li>
            <li ng-show="selected_tickets">
              <div class="row">
                <div class="col-sm-6 col-xs-6 total-label"><span translate="PUBLIC_BOOKING.EVENT.BASKET_DUE_TOTAL"></span></div>
                <div class="col-sm-3 col-xs-6"><strong>{{bb.basket.dueTotal() | currency}}</strong>
                </div>
              </div>
            </li>
          </ul>

        </div>

<!--         <div bb-basket-list class="row" ng-if="selected_tickets">
          <div class="col-sm-6">

            <div class="gift-certifcates ">
              <div ng-form class="form-inline">
                <div ng-show="!show_voucher_box">
                  <button type="button" class="btn btn-link" ng-click="show_voucher_box = true"><span translate="PUBLIC_BOOKING.EVENT.BASKET_GIFT_CERTIFICATE_QUESTION"></span></button>
                </div>
                <div ng-show="show_voucher_box" class="form-group">
                  <label for="deal_code"><span translate="PUBLIC_BOOKING.EVENT.BASKET_GIFT_CERTIFICATE_APPLY"></span>:</label>
                  <div class=" input-group">
                    <input type="text" class="form-control input-sm" id="deal_code" name="deal_code" ng-model="deal_code" placeholder="{{'PUBLIC_BOOKING.EVENT.GIFT_CERTIFICATE_CODE_PLACEHOLDER' | translate}}">
                    <span class="input-group-btn">
                    <button type="submit" class="btn btn-primary btn-sm" ng-disabled="!deal_code" ng-click="applyDeal(deal_code)"><span translate="PUBLIC_BOOKING.EVENT.APPLY_BTN"></span></button>
                  </span>
                  </div>
                </div>
              </div>

              <div class="deals-applied-wrapper" ng-if="bb.basket.hasDeal()">
                <h3><span translate="PUBLIC_BOOKING.EVENT.BASKET_GIFT_CERTIFICATES_APPLIED"></span></h3>
                <ul class="deals-applied">
                  <li ng-repeat="deal in bb.basket.getDealCodes()">
                    {{deal.description}} ({{deal.deal_code}})
                    <button type="button" class="btn btn-link btn-red" ng-click="removeDeal(deal)"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span> <span translate="PUBLIC_BOOKING.EVENT.BASKET_REMOVE_DEAL"></span></button>
                  </li>
                </ul>
                <p><span translate="PUBLIC_BOOKING.EVENT.BASKET_GIFT_CERTIFICATE_BALANCE"></span>: {{bb.basket.remainingDealBalance() | currency}}</p>
              </div>
            </div>

          </div>
        </div> -->

      </div>
    </div>

    <form name="booking_form" role="form" novalidate bb-form>

      <div class="panel panel-default event-client-details" ng-if="selected_tickets">

        <div class="panel-body">

          <h2><span translate="PUBLIC_BOOKING.EVENT.DETAILS_TITLE"></span></h2>

          <div ng-form name="client_form" class="form-horizontal" role="form" novalidate>
            <div class="form-group" ng-class="{'has-error': client_form.first_name.$invalid && (client_form.first_name.$dirty || booking_form.submitted)}">
              <label for="first_name" class="control-label col-sm-4"><span translate="PUBLIC_BOOKING.EVENT.DETAILS_FIRST_NAME"></span>:</label>
              <div class="col-sm-5">
                <input type="text" name="first_name" id="first_name" required ng-model="client.first_name" class="form-control" autocomplete="given-name"/>
              </div>
              <div class="col-sm-3 messages">
                <div class="error-message" ng-show="client_form.first_name.$invalid && booking_form.submitted" translate="PUBLIC_BOOKING.EVENT.DETAILS_FIRST_NAME_VALIDATION_MSG">
                </div>
              </div>
            </div>

            <div class="form-group" ng-class="{'has-error': client_form.last_name.$invalid && (client_form.last_name.$dirty|| booking_form.submitted)}">
              <label for="last_name" class="control-label col-sm-4"><span translate="PUBLIC_BOOKING.EVENT.DETAILS_LAST_NAME"></span>:</label>
              <div class="col-sm-5">
                <input type="text" name="last_name" id="last_name" required ng-model="client.last_name" class="form-control" autocomplete="family-name"/>
              </div>
              <div class="col-sm-3 messages">
                <div class="error-message" ng-show="client_form.last_name.$invalid && booking_form.submitted" translate="PUBLIC_BOOKING.EVENT.DETAILS_LAST_NAME_VALIDATION_MSG">
                </div>
              </div>
            </div>

            <div class="form-group" ng-class="{'has-error': client_form.email.$invalid && (client_form.email.$dirty|| booking_form.submitted)}">
              <label for="email" class="control-label col-sm-4"><span translate="PUBLIC_BOOKING.EVENT.DETAILS_EMAIL"></span>*:</label>
              <div class="col-sm-5">
                <input type="email" name="email" id="email" required ng-model="client.email" class="form-control" autocomplete="email"/>
              </div>
              <div class="col-sm-3 messages">
                <div class="error-message" ng-show="client_form.email.$invalid && booking_form.submitted"><span translate="PUBLIC_BOOKING.EVENT.DETAILS_EMAIL_VALIDATION_MSG"></span>
                </div>
              </div>
            </div>

            <div class="form-group" ng-class="{'has-error': client_form.mobile.$invalid && ((client_form.mobile.$dirty && !client_form.mobile.$focused) || booking_form.submitted)}">
              <label for="mobile" class="control-label col-sm-4"><span translate="PUBLIC_BOOKING.EVENT.STORE_PHONE"></span>:</label>
              <div class="col-sm-5">
                <input type="tel" name="mobile" id="mobile" ng-pattern="validator.getUKMobilePattern()" ng-model="client.mobile" class="form-control" autocomplete="tel"/>
              </div>
              <div class="col-sm-3 messages">
                <div class="error-message" ng-show="client_form.mobile.$dirty && client_form.email.$invalid && booking_form.submitted" translate="PUBLIC_BOOKING.EVENT.DETAILS_PHONE_MOBILE_VALIDATION_MSG">
                </div>
              </div>
            </div>

            <div class="form-group" ng-class="{'has-error': client_form.address1.$invalid && ((client_form.address1.$dirty && !client_form.address1.$focused) || booking_form.submitted)}">
              <label for="address1" class="control-label col-sm-4"><span translate="PUBLIC_BOOKING.EVENT.DETAILS_ADDRESS"></span>:</label>
              <div class="col-sm-5">
                <input type="text" name="address1" id="address1" ng-model="client.address1" class="form-control" autocomplete="address-line1"/>
              </div>
              <div class="col-sm-3 messages"> 
                <div class="error-message" ng-show="client_form.address1.$invalid && booking_form.submitted" translate="PUBLIC_BOOKING.EVENT.DETAILS_ADDRESS_VALIDATION_MSG">
                </div>
              </div>
            </div>

            <div class="form-group" ng-class="{'has-error': client_form.address2.$invalid && ((client_form.address2.$dirty && !client_form.address2.$focused) || booking_form.submitted)}">
              <label for="address2" class="control-label col-sm-4"></label>
              <div class="col-sm-5">
                <input type="text" name="address2" id="address2" ng-model="client.address2" class="form-control" autocomplete="address-line2"/>
              </div>
            </div>

            <div class="form-group" ng-class="{'has-error': client_form.address3.$invalid && ((client_form.address3.$dirty && !client_form.address3.$focused) || booking_form.submitted)}">
              <label for="address3" class="control-label col-sm-4"><span translate="PUBLIC_BOOKING.EVENT.DETAILS_TOWN"></span>:</label>
              <div class="col-sm-5">
                <input type="text" name="address3" id="address3" ng-model="client.address3" class="form-control" autocomplete="address-level2"/>
              </div>
            </div>

            <div class="form-group" ng-class="{'has-error': client_form.address4.$invalid && booking_form.submitted}">
              <label for="address4" class="control-label col-sm-4"><span translate="PUBLIC_BOOKING.EVENT.DETAILS_COUNTY"></span>:</label>
              <div class="col-sm-5">
                <input type="text" name="address4" id="address4" ng-model="client.address4" class="form-control" autocomplete="address-level1"/>
              </div>
            </div>

            <div class="form-group" ng-class="{'has-error': client_form.postcode.$invalid && ((client_form.postcode.$dirty && !client_form.postcode.$focused) || booking_form.submitted)}">
              <label for="postcode" class="control-label col-sm-4"><span translate="PUBLIC_BOOKING.EVENT.DETAILS_POSTCODE"></span>:</label>
              <div class="col-sm-5">
                <input type="text" name="postcode" id="postcode" ng-pattern="validator.getUKPostcodePattern()" ng-model="client.postcode" class="form-control" onBlur="javascript:this.value=this.value.toUpperCase()" style="text-transform:uppercase" autocomplete="postal-code"/>
              </div>
              <div class="col-sm-3 messages">
                <div class="error-message" ng-show="client_form.postcode.$invalid && booking_form.submitted" translate="PUBLIC_BOOKING.EVENT.INVALID_POSTCODE">
                </div>
              </div>
            </div>

            <div bb-client-details ng-show="client_details.hasQuestions">

              <div class="form-group" ng-repeat="question in client_details.questions" ng-if="question.currentlyShown" bb-question-line ng-class="{ 'check': question.detail_type == 'check', 'has-error': client_form['q' + question.id].$invalid && (client_form['q' + question.id].$dirty || booking_form.submitted)}">
                <label ng-hide="question.detail_type == 'check'" for="{{question.id}}" class="control-label col-sm-4">{{question.name}}<span ng-show="question.required">*</span></label>
                <div ng-show="question.detail_type == 'check'" class="col-sm-4 hidden-xs">&nbsp;</div>
                <div class="col-sm-5">
                  <input bb-question="question" />
                </div>
                <div class="col-sm-3 messages">
                  <div class="error-message" ng-show="client_form['q' + question.id].$invalid && ( client_form['q' + question.id].$dirty || booking_form.submitted )"><span translate="PUBLIC_BOOKING.EVENT.DETAILS_VALIDATION_MSG"></span>
                  </div>
                </div>
              </div>
            </div>

          </div>

          <div uib-accordion close-others="false" ng-init="use_my_details = true">
            <div ng-repeat="item in current_ticket_items" bb-count-ticket-types="current_ticket_items">
              <div ng-form name="client_ticket_form" class="form-horizontal" role="form" novalidate>
                <div ticket-accordion uib-accordion-group is-open="is_open" ng-init="is_open = $first">
                  <div uib-accordion-heading>
                    <h2><span translate="PUBLIC_BOOKING.EVENT.UIB_ACCORDION.TICKET_WORD"></span> <span ng-if="current_ticket_items.length != 1">{{$index + 1}}</span> <span translate="PUBLIC_BOOKING.EVENT.UIB_ACCORDION.DETAILS_WORD"></span> <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': is_open, 'glyphicon-chevron-right': !is_open}"></i></h2>
                  </div>


                  <div ng-if="$first" class="form-group">
                    <label for="use_my_details" class="control-label col-sm-4"><span translate="PUBLIC_BOOKING.EVENT.UIB_ACCORDION.ATTENDEE_IS_YOU_QUESTION"></span></label>
                    <div class="col-sm-5">
                      <label><input type="checkbox" name="use_my_details" id="use_my_details" ng-model="$parent.use_my_details"><span translate="PUBLIC_BOOKING.EVENT.UIB_ACCORDION.ATTENDEE_USE_MY_DETAILS"></span></label>
                    </div>
                  </div>

                  <div class="form-group" ng-class="{'has-error': (!$first || !use_my_details) && client_ticket_form.attendee_first_name.$invalid && (client_ticket_form.attendee_first_name.$dirty || booking_form.submitted)}">
                    <label for="attendee_first_name" class="control-label col-sm-4"><span translate="PUBLIC_BOOKING.EVENT.UIB_ACCORDION.DETAILS_FIRST_NAME"></span>*:</label>
                    <div ng-if="use_my_details && $first" class="col-sm-5">
                      <input disabled type="text" ng-model="client.first_name" name="attendee_first_name" class="form-control" />
                    </div>
                    <div ng-if="!use_my_details || !$first" class="col-sm-5">
                      <input type="text" ng-model="item.first_name" name="attendee_first_name" class="form-control" />
                    </div>
                  </div>

                  <div class="form-group" ng-class="{'has-error': (!$first || !use_my_details) && client_ticket_form.attendee_last_name.$invalid && (client_ticket_form.attendee_last_name.$dirty|| booking_form.submitted)}">
                    <label for="attendee_last_name" class="control-label col-sm-4"><span translate="PUBLIC_BOOKING.EVENT.UIB_ACCORDION.DETAILS_LAST_NAME"></span>*:</label>
                    <div ng-if="use_my_details && $first" class="col-sm-5">
                      <input disabled type="text" ng-model="client.last_name" name="attendee_last_name" class="form-control" />
                    </div>
                    <div ng-if="!use_my_details || !$first" class="col-sm-5">
                      <input type="text" ng-model="item.last_name" name="attendee_last_name" class="form-control" />
                    </div>
                  </div>

                  <div class="form-group" ng-class="{'has-error': (!$first || !use_my_details) && client_ticket_form.attendee_email.$dirty && client_ticket_form.attendee_email.$invalid}">
                    <label for="attendee_email" class="control-label col-sm-4"><span translate="PUBLIC_BOOKING.EVENT.UIB_ACCORDION.DETAILS_EMAIL"></span>:</label>
                    <div ng-if="use_my_details && $first" class="col-sm-5">
                      <input disabled type="email" ng-model="client.email" name="attendee_email" required class="form-control" />
                    </div>
                    <div ng-if="!use_my_details || !$first" class="col-sm-5">
                      <input type="email" ng-model="item.email" name="attendee_email" class="form-control" />
                    </div>
                    <div class="col-sm-3 messages">
                      <div class="error-message" ng-show="(!$first || !use_my_details) && client_ticket_form.attendee_email.$dirty && client_ticket_form.attendee_email.$invalid && booking_form.submitted"><span translate="PUBLIC_BOOKING.EVENT.UIB_ACCORDION.DETAILS_EMAIL_VALIDATION_MSG"></span>
                      </div>
                    </div>
                  </div>

                  <!-- \/\/\/\/\/\/\/\/ -->
                  <!-- CUSTOM QUESTIONS -->
                  <!-- \/\/\/\/\/\/\/\/ -->

                  <div bb-item-details="item" bb-suppress-basket-update="$index">
                    <div ng-form name="booking_questions_form">
                      <div ng-repeat="question in item_details.questions">
                        <div class="form-group" ng-if="question.currentlyShown" bb-question-line ng-class="{'has-error': booking_questions_form['q' + question.id].$invalid && (booking_questions_form['q' + question.id].$dirty || booking_form.submitted)}">
                          <label for="{{question.id}}" class="control-label col-sm-4">{{question.name}}<span ng-show="question.required">*</span>:</label>
                          <div class="col-sm-5">
                            <input bb-question="question" />
                          </div>
                          <div class="col-sm-3 messages">
                            <div class="error-message" ng-show="booking_questions_form['q' + question.id].$invalid && ( booking_questions_form['q' + question.id].$dirty || booking_form.submitted )" translate="PUBLIC_BOOKING.EVENT.UIB_ACCORDION.DETAILS_VALIDATION_MSG">
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                </div>
              </div>
            </div>

          </div><!-- accordion close -->

        </div>
      </div>

      <div ng-if="!bb.isAdmin && selected_tickets" ng-form name="terms_and_conditons_form" id="terms_and_conditons_form" role="form" novalidate class="form-horizontal">
        <div class="form-group check" ng-class="{'has-error': terms_and_conditons_form.tandc.$invalid && booking_form.submitted}">
          <div class="col-sm-4 hidden-xs">&nbsp;</div>
          <div class="col-sm-5">
            <label>
              <input type="checkbox" required ng-model="tandc" id="tandc" name="tandc" /><span translate="PUBLIC_BOOKING.EVENT.DETAILS_TERMS"></span>.
            </label>
          </div>
          <div class="col-sm-3 messages">
              <div class="error-message" ng-show="terms_and_conditons_form.tandc.$invalid && booking_form.submitted"><span translate="PUBLIC_BOOKING.EVENT.DETAILS_TERMS_VALIDATION_MSG"></span>
            </div>
          </div>
        </div>
      </div>

      <div class="button-group">

        <div class="row">

          <div class="col-sm-push-9 col-sm-3">

            <div ng-if="!selected_tickets">

              <button type="button" class="btn btn-primary btn-block pull-right" ng-disabled="event.numTicketsSelected() == 0" ng-click="selectTickets()" ng-show="event.getSpacesLeft() > 0">
                <span translate="PUBLIC_BOOKING.EVENT.RESERVE_TICKET" translate-interpolation="messageformat" translate-values="{num_tickets: event.numTicketsSelected()}"></span>
                <span class="glyphicon glyphicon-chevron-right"></span>
              </button>

              <button type="button" class="btn btn-primary btn-block pull-right" ng-disabled="event.numTicketsSelected() == 0" ng-click="selectTickets()" ng-show="event.getSpacesLeft() <= 0 && bb.company.settings.has_waitlists">
                <span translate="PUBLIC_BOOKING.EVENT.EVENT_JOIN_WAITLIST"></span>
              </button>

            </div>

            <div ng-if="selected_tickets">

              <button type="submit" class="btn btn-primary btn-block pull-right" ng-click="validator.validateForm(booking_form) && checkReady() && routeReady()">
                <span translate="PUBLIC_BOOKING.EVENT.BOOK_TICKET" translate-interpolation="messageformat" translate-values="{num_tickets: event.numTicketsSelected()}"></span>
              </button>

            </div>

          </div>

          <div class="col-sm-3 col-sm-pull-3">

            <button type="button" class="btn btn-default" bb-debounce ng-click="decideNextPage('event_list')">
              <span translate="PUBLIC_BOOKING.EVENT.BACK_BTN"></span>
            </button>

          </div>

        </div>

      </div><!-- button group -->

    </form>

  </div>
</div>
