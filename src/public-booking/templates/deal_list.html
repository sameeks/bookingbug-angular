<div bb-deals>

  <h2
    class="deal-list-heading"
    translate="PUBLIC_BOOKING.DEAL_LIST.HEADING">
  </h2>

  <div ng-if="bb.stacked_items && bb.stacked_items[0].deal">

    <h4 translate="PUBLIC_BOOKING.DEAL_LIST.SELECTED_CERTS_HEADING"></h4>

    <table class="table table-bordered">

      <thead>
        <tr>
          <th translate="PUBLIC_BOOKING.DEAL_LIST.CERTIFICATE_COL_HEADING"></th>
          <th translate="PUBLIC_BOOKING.DEAL_LIST.PRICE_COL_HEADING"></th>
          <th>&nbsp;</th>
        </tr>
      </thead>

      <tbody>
        <tr
          ng-repeat="item in bb.stacked_items"
          ng-class="{'last-item': $last}">
          <td>
            <p>
              {{item.deal.name}}
              <br/>

              <form
                ng-if="!bb.company_settings.no_recipient"
                name="recipient_form"
                class="form-horizontal"
                role="form"
                bb-form-resettable
                bb-form
                novalidate>

                <div ng-hide="recipient_form.submitted && item.recipient">

                  <small translate="PUBLIC_BOOKING.DEAL_LIST.RECIPIENT_FORM.HEADING"><small>

                  <br/>

                  <p>
                    <label
                      for="recipient_name"
                      class="control-label col-sm-4">
                        <small>
                          <span translate="PUBLIC_BOOKING.DEAL_LIST.RECIPIENT_FORM.RECIPIENT_NAME_LBL"></span>:
                        </small>
                      </label>
                      <input
                        type="text"
                        name="recipient_name"
                        id="recipient_name"
                        ng-model="recipient.name"
                        ng-pattern="validator.alpha"
                      />
                    <br/>

                  </p>

                    <p>
                      <label
                        for="recipient_mail"
                        class="control-label col-sm-4">
                        <small>
                          <span translate="PUBLIC_BOOKING.DEAL_LIST.RECIPIENT_TERMINOLOGY.EMAIL_LBL"></span>:
                        </small>
                      </label>
                      <input
                        type="email"
                        name="recipient_mail"
                        id="recipient_mail"
                        ng-model="recipient.mail"
                      />
                      <br/>
                    </p>

                    <p>
                      <button
                        ng-click="submitForm() && addRecipient(item, recipient)"
                        translate="PUBLIC_BOOKING.DEAL_LIST.RECIPIENT_FORM.ADD_RECIPIENT_BTN">
                      </button>
                      <br/>
                    </p>

                    <br/>

                    <p
                      ng-show="recipient_form.recipient_name.$invalid && recipient_form.submitted"
                      class="error-message"
                      translate="PUBLIC_BOOKING.DEAL_LIST.RECIPIENT_FORM.NAME_REQUIRED">
                    </p>

                    <p
                      ng-show="recipient_form.recipient_mail.$invalid && recipient_form.submitted"
                      class="error-message"
                      translate="PUBLIC_BOOKING.DEAL_LIST.RECIPIENT_FORM.EMAIL_INVALID">
                    </p>

                  </div>

                </form>

                <div ng-if="item.recipient">

                 <h5 translate="PUBLIC_BOOKING.DEAL_LIST.RECIPIENT_HEADING"></h5>

                 <p ng-if="item.recipient">
                  <span translate="PUBLIC_BOOKING.DEAL_LIST.RECIPIENT_NAME_LBL"></span>:
                  <small>{{item.recipient}}</small>
                </p>

                <p ng-if="item.recipient_mail">
                  <span translate="PUBLIC_BOOKING.DEAL_LIST.EMAIL_LBL"></span>:
                  <small>{{item.recipient_mail}}</small>
                </p>

              </div>

            </p>

          </td>

          <td class="text-right">
            {{item.deal.price | currency }}
          </td>

          <td class="text-center">
            <span
              class="fa fa-trash"
              aria-hidden="true"
              ng-click="removeDeal(item)">
            </span>
          </td>

        </tr>
      </tbody>
    </table>
  </div>

  <div
    class="panel panel-default bb-event-card"
    ng-repeat="deal in deals">

    <div class="panel-body">
      <div class="row vertical-row-align">

        <div class="col-sm-9 col-xs-12 deal-details">

          <h3>{{deal.name}}</h3>

          <ul class="deal-summary-list">
            <li class="deal-description">
              <span>{{deal.description}}</span>
            </li>
            <li class="price">
              <span class="bb-icon icon-price"></span>
              <span>{{deal.price | currency}}</span>
            </li>
          </ul>

        </div>

        <div class="col-sm-3 deal-select">
          <button
            type="button"
            ng-click="selectDeal(deal)"
            class="btn btn-primary btn-block"
            translate="PUBLIC_BOOKING.DEAL_LIST.BUY_BTN">
          </button>
        </div>

      </div>
    </div>
  </div>

  <div ng-if="bb.stacked_items && bb.stacked_items[0].deal">

    <button
      type="button"
      class="btn btn-primary btn-block"
      ng-click="purchaseDeals()"
      translate="PUBLIC_BOOKING.DEAL_LIST.BUY_GIFT_CERT_BTN">
    </button>

  </div>

  <div class="bb-step-navigation">

    <button
      type="button"
      class="btn btn-default"
      ng-click="loadPreviousStep()"
      ng-show="bb.current_step > 1"
      translate="PUBLIC_BOOKING.DEAL_LIST.BACK_BTN">
    </button>

  </div>

</div>
